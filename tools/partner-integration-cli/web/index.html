<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Partner Integration Manifest Builder</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="app-shell">
    <header>
      <h1>Partner Integration Manifest Builder</h1>
      <p class="lead">Collect the same details requested by the Partner Integration CLI to produce an <code>integration.yaml</code> and optional <code>publisher.json</code>.</p>
    </header>

    <section class="card" id="partner-details">
      <h2>Partner Details</h2>
      <div class="field-grid">
        <label class="field-with-info">
          <span class="field-label-text">Integration Name<span class="required">*</span>
            <span class="info-wrapper info-inline">
              <button
                type="button"
                class="info-badge info-inline"
                aria-label="Integration name guidance. Integration name is dynamically rendered for customers (e.g., Contoso for Lamna Healthcare)."
              >
                <span class="info-symbol" aria-hidden="true">i</span>
              </button>
              <span class="tooltip-content" role="tooltip">
                <strong>Integration name</strong>
                <span>Integration name is dynamically rendered for customers (e.g., Contoso for Lamna Healthcare).</span>
              </span>
            </span>
          </span>
          <input id="integration-name" type="text" placeholder="partner-integration" />
        </label>
        <label>
          <span class="field-label-text">Integration Version<span class="required">*</span></span>
          <input id="integration-version" type="text" placeholder="0.0.1" />
        </label>
        <label class="partner-id-field field-with-info">
          <span class="field-label-text">Partner ID<span class="required">*</span>
            <span class="info-wrapper info-inline">
              <button
                type="button"
                class="info-badge info-inline"
                aria-label="Partner ID guidance. Partner ID should match the identifier from your app source (e.g., Microsoft Partner Center)."
              >
                <span class="info-symbol" aria-hidden="true">i</span>
              </button>
              <span class="tooltip-content" role="tooltip">
                <strong>Partner ID</strong>
                <span>Partner ID should match the identifier from your app source (e.g., Microsoft Partner Center).</span>
              </span>
            </span>
          </span>
          <input id="partner-id" type="text" placeholder="00000000-0000-0000-0000-000000000000" />
        </label>
      </div>
    </section>

    <section class="card" id="server-auth">
      <h2 class="title-with-info">Server Authentication
        <span class="info-wrapper">
          <button
            type="button"
            class="info-badge"
            aria-label="Server Authentication guidance. This section is for authenticating the partner server calling DDE/Partner API. Learn more about using Entra ID as the identity solution."
          >
            <span class="info-symbol" aria-hidden="true">i</span>
          </button>
          <span class="tooltip-content" role="tooltip">
            <strong>Server authentication</strong>
            <span>This section is for authenticating the partner server calling DDE/Partner API.</span>
          </br>
            <a href="https://learn.microsoft.com/en-us/industry/healthcare/dragon-copilot/sdk/partner-apis/entra-id" target="_blank" rel="noopener noreferrer">EntraId as an identity solution</a>
          </span>
        </span>
      </h2>
      <p class="hint">Define each issuer, identity claim and allowed claim values. Add at least one entry.</p>
      <div id="server-auth-list" class="dynamic-list"></div>
      <button type="button" id="add-server-auth" class="secondary">Add Issuer</button>
    </section>

    <section class="card" id="note-sections">
      <h2>Note Sections</h2>
      <p class="hint">Choose how Dragon Copilot should map generated sections. Select "All Standard Sections" for the default eleven sections.</p>
      <div class="field-grid">
        <label>Strategy
          <select id="note-strategy">
            <option value="all">All Standard Sections</option>
            <option value="manual">Manual Selection</option>
            <option value="optional">No Sections Mapped</option>
          </select>
        </label>
      </div>
      <div id="manual-note-config" class="stack"></div>
    </section>

    <section class="card" id="instance">
      <h2 class="title-with-info">Instance Configuration
        <span class="info-wrapper">
          <button
            type="button"
            class="info-badge"
            aria-label="Instance configuration guidance. This section is for adding a partner manifest instance to a client environment. Indicate which items must be collected by the client. Items not required by the partner are omitted from the manifest."
          >
            <span class="info-symbol" aria-hidden="true">i</span>
          </button>
          <span class="tooltip-content" role="tooltip">
            <strong>Instance configuration</strong>
            <span>This section is for adding a partner manifest instance to a client environment.</span>
            <span>Indicate which items must be collected by the client admin. Items not required by the partner are omitted from the manifest.</span>
          </span>
        </span>
      </h2>
      <article class="sub-card">
        <h3>Client Authentication</h3>
        <div class="field-grid">
          <label>
            <span class="field-label-text">Allow Multiple Issuers?<span class="required">*</span></span>
            <select id="client-allow-multiple">
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </label>
          <label class="full">Access Token Issuer Default (optional)<input id="client-access-issuer" type="text" placeholder="https://login.microsoftonline.com/[TENANT_ID]/v2.0" /></label>
        </div>
        <fieldset class="toggle">
          <legend class="title-with-info">User Identity Claim
            <span class="info-wrapper info-inline">
              <button
                type="button"
                class="info-badge info-inline"
                aria-label="User identity claim guidance. Optional claim containing the EHR identity of an end user. Defaults to 'sub.'"
              >
                <span class="info-symbol" aria-hidden="true">i</span>
              </button>
              <span class="tooltip-content" role="tooltip">
                <strong>User identity claim</strong>
                <span>Optional claim containing the EHR identity of an end user. Defaults to 'sub'.</span>
              </span>
            </span>
          </legend>
          <label><input type="checkbox" id="client-include-user" /> Prompt client for user identity claim</label>
          <div id="client-user-fields" class="field-grid nested">
            <label>Default Value<input id="client-user-default" type="text" value="sub" /></label>
            <label>Required?
              <select id="client-user-required">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>
          </div>
        </fieldset>
        <fieldset class="toggle">
          <legend class="title-with-info">Customer Identity Claim
            <span class="info-wrapper info-inline">
              <button
                type="button"
                class="info-badge info-inline"
                aria-label="Customer identity claim guidance. Optional claim containing the Microsoft environment identifier."
              >
                <span class="info-symbol" aria-hidden="true">i</span>
              </button>
              <span class="tooltip-content" role="tooltip">
                <strong>Customer identity claim</strong>
                <span>Optional claim containing the Microsoft environment identifier.</span>
              </span>
            </span>
          </legend>
          <label><input type="checkbox" id="client-include-customer" /> Prompt client for customer identity claim</label>
          <div id="client-customer-fields" class="field-grid nested">
            <label>Default Value<input id="client-customer-default" type="text" value="http://customerid.dragon.com" /></label>
            <label>Required?
              <select id="client-customer-required">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>
          </div>
        </fieldset>
      </article>

      <article class="sub-card">
        <h3 class="title-with-info">Web Launch
          <span class="info-wrapper">
            <button
              type="button"
              class="info-badge"
              aria-label="Web launch guidance. Dragon Copilot embedded web UI offers SMART on FHIR and Token Launch. Partners must support one or both options. Follow the documentation links for each launch mode."
            >
              <span class="info-symbol" aria-hidden="true">i</span>
            </button>
            <span class="tooltip-content" role="tooltip">
              <strong>Web launch options</strong>
              <span>Dragon Copilot embedded web UI offers SMART on FHIR and Token Launch. Partners must support one or both options.</span>
              <br />
              <a href="https://learn.microsoft.com/en-us/industry/healthcare/dragon-copilot/sdk/embedded-desktop/smart-fhir-app-launch" target="_blank" rel="noopener noreferrer">SMART on FHIR documentation</a>
              <a href="https://learn.microsoft.com/en-us/industry/healthcare/dragon-copilot/sdk/embedded-desktop/token-launch" target="_blank" rel="noopener noreferrer">Token Launch documentation</a>
            </span>
          </span>
        </h3>
        <p class="hint">Select the launch capabilities supported by this manifest.</p>
        <div class="field-grid">
          <label>
            <span class="field-label-text">Launch Mode<span class="required">*</span></span>
            <select id="web-launch-mode">
              <option value="both">Both SMART on FHIR and Token Launch</option>
              <option value="sof">SMART on FHIR Only</option>
              <option value="token">Token Launch Only</option>
            </select>
          </label>
        </div>
        <div id="web-sof-fields" class="nested">
          <h4>⚙️ SMART on FHIR Configuration</h4>
          <div class="field-grid">
            <label>
              <span class="field-label-text">Access Token Issuer Default (optional)</span>
              <input id="web-sof-default" type="text" />
            </label>
          </div>
        </div>
        <div id="web-token-fields" class="nested">
          <h4>⚙️ Token Launch Configuration</h4>
          <div class="field-grid">
            <label>
              <span class="field-label-text">Reuse Client Authentication?<span class="required">*</span></span>
              <select id="web-token-reuse">
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </label>
          </div>
          <div id="web-token-multi-container" class="field-grid is-hidden">
            <label id="web-token-multi-wrapper">
              <span class="field-label-text">Allow Multiple Issuers?<span class="required">*</span></span>
              <select id="web-token-multi">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>
          </div>
          <div id="web-token-issuer-list" class="dynamic-list"></div>
          <button type="button" id="add-web-token-issuer" class="secondary">Add Token Issuer</button>
        </div>
      </article>

      <article class="sub-card">
        <h3 class="title-with-info">Context Retrieval
          <span class="info-wrapper">
            <button
              type="button"
              class="info-badge"
              aria-label="Context Retrieval guidance. Interop service ONLY. Items the partner wishes to include and to be collected by the customer administrator."
            >
              <span class="info-symbol" aria-hidden="true">i</span>
            </button>
            <span class="tooltip-content" role="tooltip">
              <strong>Context retrieval</strong>
              <span>Interop service ONLY. Items the partner wishes to include and to be collected by the customer administrator.</span>
            </span>
          </span>
        </h3>
  <p class="hint">Select context values that the customer can provide. Leave empty when none are required.</p>
  <p class="hint">Interop environment values (environment name, environment id, EHR type, product name, partner id) are collected automatically.</p>
  <p class="hint">Context item names, types, and descriptions are fixed. Toggle only whether each item is required.</p>
        <div id="context-item-list" class="stack"></div>
        <button type="button" id="add-context-item" class="secondary">Add Context Item</button>
      </article>
    </section>

    <section class="card" id="publisher">
      <h2>Publisher Configuration (Optional)</h2>
      <label><input type="checkbox" id="include-publisher" checked /> Generate <code>publisher.json</code></label>
      <div id="publisher-fields" class="field-grid">
        <label>
          <span class="field-label-text">Publisher ID<span class="required">*</span></span>
          <input id="publisher-id" type="text" placeholder="contoso.healthcare" />
        </label>
        <label>
          <span class="field-label-text">Publisher Name<span class="required">*</span></span>
          <input id="publisher-name" type="text" placeholder="Contoso Health" />
        </label>
        <label>
          <span class="field-label-text">Website URL<span class="required">*</span></span>
          <input id="publisher-website" type="text" placeholder="https://contoso.com" />
        </label>
        <label>
          <span class="field-label-text">Privacy Policy URL<span class="required">*</span></span>
          <input id="publisher-privacy" type="text" placeholder="https://contoso.com/privacy" />
        </label>
        <label>
          <span class="field-label-text">Support URL<span class="required">*</span></span>
          <input id="publisher-support" type="text" placeholder="https://contoso.com/support" />
        </label>
        <label>
          <span class="field-label-text">Contact Email<span class="required">*</span></span>
          <input id="publisher-email" type="email" placeholder="support@contoso.com" />
        </label>
        <label>
          <span class="field-label-text">Offer ID<span class="required">*</span></span>
          <input id="publisher-offer" type="text" placeholder="contoso-integration-suite" />
        </label>
      </div>
    </section>

    <section id="form-errors" class="error-panel" role="alert" aria-live="assertive" aria-atomic="true" hidden tabindex="-1"></section>

    <section class="actions">
      <button type="button" id="generate" class="primary">Generate Files</button>
      <button type="button" id="reset" class="secondary">Reset</button>
    </section>

    <section class="card" id="output">
      <h2>Generated Output</h2>
      <div id="output-content" hidden>
        <div class="output-grid">
          <div data-output="yaml">
            <h3>integration.yaml</h3>
            <textarea id="manifest-output" readonly rows="16" aria-label="integration.yaml output"></textarea>
            <button type="button" data-download="yaml" class="secondary">Download YAML</button>
          </div>
          <div data-output="json">
            <h3>publisher.json</h3>
            <textarea id="publisher-output" readonly rows="16" aria-label="publisher.json output"></textarea>
            <button type="button" data-download="json" class="secondary">Download JSON</button>
          </div>
        </div>
        <p class="hint">Use the packaged script to validate and bundle your manifest before uploading.</p>
        <div class="run-steps">
          <h3>Validate &amp; Package Checklist</h3>
          <ol class="step-list">
            <li>Download <code>integration.yaml</code> and (optionally) <code>publisher.json</code> into the same folder.</li>
            <li>Download the sample assets archive (below) and extract its <code>assets</code> folder beside those files.</li>
            <li>Run <code>pwsh ./scripts/build-validate-and-package.ps1 -ManifestDirectory "path/to/manifest-folder"</code> from <code>tools/partner-integration-cli</code>.</li>
            <li id="upload-note">Upload the generated ZIP reported by the script.</li>
          </ol>
          <p class="hint">Already ran the build? Append <code>-SkipBuild</code> to reuse the previous output.</p>
        </div>

        <article class="sub-card" id="assets-helper">
          <h3>Assets Helper</h3>
          <p class="hint">Download a starter <code>assets</code> folder that includes <code>logo_large.png</code>. Place the folder next to your manifest before packaging.</p>
          <button type="button" id="download-assets" class="secondary">Download Sample Assets</button>
          <p class="hint">Replace the placeholder logo with your branded image before submitting to Dragon Copilot.</p>
        </article>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" integrity="sha384-+pxiN6T7yvpryuJmE1gM9PX7yQit15auDb+ZwwvJOd/4be2Cie5/IuVXgQb/S9du" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
